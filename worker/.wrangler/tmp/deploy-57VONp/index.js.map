{
  "version": 3,
  "sources": ["../../../src/uno-logic.ts", "../../../src/index.ts"],
  "sourceRoot": "D:\\UNO app AIKS\\Backup\\BAck 4 Cloud\\NEW ONO CLOUD\\ono\\worker\\.wrangler\\tmp\\deploy-57VONp",
  "sourcesContent": ["import { UnoCard, CardColor, CardType, GameState } from './types';\n\nexport function createStandardDeck(): UnoCard[] {\n  const deck: UnoCard[] = [];\n\n  const colors = [CardColor.red, CardColor.blue, CardColor.green, CardColor.yellow];\n\n  for (const color of colors) {\n    deck.push({ color, type: CardType.number, number: 0, isWild: false, isAction: false });\n\n    for (let i = 1; i <= 9; i++) {\n      deck.push({ color, type: CardType.number, number: i, isWild: false, isAction: false });\n      deck.push({ color, type: CardType.number, number: i, isWild: false, isAction: false });\n    }\n\n    deck.push({ color, type: CardType.skip, isWild: false, isAction: true });\n    deck.push({ color, type: CardType.skip, isWild: false, isAction: true });\n    deck.push({ color, type: CardType.reverse, isWild: false, isAction: true });\n    deck.push({ color, type: CardType.reverse, isWild: false, isAction: true });\n    deck.push({ color, type: CardType.drawTwo, isWild: false, isAction: true });\n    deck.push({ color, type: CardType.drawTwo, isWild: false, isAction: true });\n  }\n\n  for (let i = 0; i < 4; i++) {\n    deck.push({ color: CardColor.wild, type: CardType.wild, isWild: true, isAction: true });\n    deck.push({ color: CardColor.wild, type: CardType.wildDrawFour, isWild: true, isAction: true });\n  }\n\n  return deck;\n}\n\nexport function shuffleDeck(deck: UnoCard[]): UnoCard[] {\n  const shuffled = [...deck];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\nexport function dealCards(deck: UnoCard[], playerCount: number): UnoCard[][] {\n  const hands: UnoCard[][] = [];\n  const cardsPerPlayer = 7;\n\n  for (let i = 0; i < playerCount; i++) {\n    hands.push([]);\n  }\n\n  for (let i = 0; i < cardsPerPlayer; i++) {\n    for (let j = 0; j < playerCount; j++) {\n      if (deck.length > 0) {\n        hands[j].push(deck.shift()!);\n      }\n    }\n  }\n\n  return hands;\n}\n\nexport function canPlayCard(\n  card: UnoCard,\n  topCard: UnoCard,\n  activeColor: CardColor,\n  pendingDrawCount: number,\n  playerHand?: UnoCard[]\n): boolean {\n  if (card.isWild) {\n    if (card.type === CardType.wildDrawFour) {\n      if (playerHand && playerHand.length > 0) {\n        const hasMatchingColor = playerHand.some((c) => \n          !c.isWild && c.color === activeColor\n        );\n        if (hasMatchingColor) {\n          return false;\n        }\n      }\n      if (pendingDrawCount > 0 && pendingDrawCount < 8) {\n        return false;\n      }\n      if (pendingDrawCount >= 8) {\n        return true;\n      }\n      return true;\n    }\n    return true;\n  }\n\n  if (card.color === activeColor) {\n    return true;\n  }\n\n  if (topCard.isWild) {\n    return card.color === activeColor;\n  }\n\n  if (card.type === topCard.type) {\n    return true;\n  }\n\n  if (card.type === CardType.number && topCard.type === CardType.number && card.number === topCard.number) {\n    return true;\n  }\n\n  if (pendingDrawCount > 0) {\n    if (pendingDrawCount % 2 === 0 && card.type === CardType.drawTwo && card.color === activeColor) {\n      return true;\n    }\n    if (pendingDrawCount >= 8 && card.type === CardType.wildDrawFour) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function processCardPlay(\n  gameState: GameState,\n  card: UnoCard,\n  chosenColor: CardColor | undefined,\n  playerId: string,\n  playerIds: string[]\n): GameState {\n  let newActiveColor = gameState.activeColor;\n  let newDirection = gameState.direction;\n  let newPendingDrawCount = gameState.pendingDrawCount;\n  let newCurrentTurnPlayerId = playerId;\n  const newDiscardPile = [...gameState.discardPile, card];\n\n  if (card.isWild) {\n    if (chosenColor) {\n      newActiveColor = chosenColor;\n    } else {\n      newActiveColor = CardColor.red;\n    }\n  } else {\n    newActiveColor = card.color;\n  }\n\n  if (card.type === CardType.skip) {\n    newCurrentTurnPlayerId = getNextPlayer(playerId, playerIds, newDirection);\n    newCurrentTurnPlayerId = getNextPlayer(newCurrentTurnPlayerId, playerIds, newDirection);\n  } else if (card.type === CardType.reverse) {\n    newDirection *= -1;\n    if (playerIds.length === 2) {\n      newCurrentTurnPlayerId = getNextPlayer(playerId, playerIds, newDirection);\n    }\n  } else if (card.type === CardType.drawTwo) {\n    if (newPendingDrawCount > 0 && newPendingDrawCount % 2 === 0) {\n      newPendingDrawCount += 2;\n    } else {\n      newPendingDrawCount = 2;\n    }\n    newCurrentTurnPlayerId = getNextPlayer(playerId, playerIds, newDirection);\n  } else if (card.type === CardType.wildDrawFour) {\n    if (newPendingDrawCount >= 8) {\n      newPendingDrawCount += 4;\n    } else {\n      newPendingDrawCount = 4;\n    }\n    newCurrentTurnPlayerId = getNextPlayer(playerId, playerIds, newDirection);\n  } else {\n    newCurrentTurnPlayerId = getNextPlayer(playerId, playerIds, newDirection);\n  }\n\n  if (card.type !== CardType.drawTwo && card.type !== CardType.wildDrawFour) {\n    newPendingDrawCount = 0;\n  }\n\n  const animationId = `${playerId}|${JSON.stringify(card)}|${Date.now()}`;\n\n  return {\n    ...gameState,\n    discardPile: newDiscardPile,\n    activeColor: newActiveColor,\n    direction: newDirection,\n    pendingDrawCount: newPendingDrawCount,\n    currentTurnPlayerId: newCurrentTurnPlayerId,\n    lastPlayedCardJson: JSON.stringify(card),\n    pendingWildColorChoice: card.isWild && chosenColor ? chosenColor : null,\n    lastPlayedCardAnimationId: animationId,\n    stateVersion: gameState.stateVersion + 1,\n    lastActivity: new Date().toISOString(),\n  };\n}\n\nexport function getNextPlayer(currentPlayerId: string, playerIds: string[], direction: number, playersWithSeats?: Array<{ id: string; seatNumber?: number }>): string {\n  if (playersWithSeats && playersWithSeats.length > 0) {\n    const currentPlayer = playersWithSeats.find(p => p.id === currentPlayerId);\n    if (!currentPlayer) {\n      return playerIds[0];\n    }\n\n    const sortedPlayers = [...playersWithSeats].sort((a, b) => {\n      const seatA = a.seatNumber ?? 999;\n      const seatB = b.seatNumber ?? 999;\n      return seatA - seatB;\n    });\n\n    const currentIndex = sortedPlayers.findIndex(p => p.id === currentPlayerId);\n    if (currentIndex === -1) {\n      return sortedPlayers[0].id;\n    }\n\n    let nextIndex = currentIndex + direction;\n    if (nextIndex < 0) {\n      nextIndex = sortedPlayers.length - 1;\n    } else if (nextIndex >= sortedPlayers.length) {\n      nextIndex = 0;\n    }\n\n    return sortedPlayers[nextIndex].id;\n  }\n\n  const currentIndex = playerIds.indexOf(currentPlayerId);\n  if (currentIndex === -1) {\n    return playerIds[0];\n  }\n\n  let nextIndex = currentIndex + direction;\n  if (nextIndex < 0) {\n    nextIndex = playerIds.length - 1;\n  } else if (nextIndex >= playerIds.length) {\n    nextIndex = 0;\n  }\n\n  return playerIds[nextIndex];\n}\n\nexport async function checkUnoCall(\n  gameState: GameState,\n  playerId: string,\n  handSize: number,\n  env: any,\n  roomCode: string\n): Promise<void> {\n  const playerIds = Object.keys(gameState.unoCalled);\n  \n  for (const pid of playerIds) {\n    if (pid !== playerId && gameState.unoCalled[pid] === true) {\n      const lastCardPlayTime = new Date(gameState.lastActivity).getTime();\n      const now = new Date().getTime();\n      \n      if (now - lastCardPlayTime > 2000) {\n        continue;\n      }\n\n      const playerResult = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n        .bind(pid, roomCode)\n        .first();\n      const player = playerResult as { hand_json: string } | null;\n\n      if (player) {\n        const hand = JSON.parse(player.hand_json) as UnoCard[];\n        if (hand.length !== 1 && gameState.unoCalled[pid]) {\n          const penalty = hand.concat(gameState.drawPile.splice(0, 2));\n          await env.DB.prepare('UPDATE players SET hand_json = ?, card_count = ? WHERE id = ?')\n            .bind(JSON.stringify(penalty), penalty.length, pid)\n            .run();\n          \n          gameState.unoCalled[pid] = false;\n          gameState.drawPile = gameState.drawPile;\n        }\n      }\n    }\n  }\n\n  if (handSize === 1 && !gameState.unoCalled[playerId]) {\n    setTimeout(async () => {\n      const playerResult = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n        .bind(playerId, roomCode)\n        .first();\n      const player = playerResult as { hand_json: string } | null;\n\n      if (player) {\n        const hand = JSON.parse(player.hand_json) as UnoCard[];\n        if (hand.length === 1 && !gameState.unoCalled[playerId]) {\n          const penalty = hand.concat(gameState.drawPile.splice(0, 2));\n          env.DB.prepare('UPDATE players SET hand_json = ?, card_count = ? WHERE id = ?')\n            .bind(JSON.stringify(penalty), penalty.length, playerId)\n            .run();\n        }\n      }\n    }, 2000);\n  }\n}\n", "import { createStandardDeck, shuffleDeck, dealCards, canPlayCard, processCardPlay, getNextPlayer, checkUnoCall } from './uno-logic';\nimport { Room, Player, GameState, RoomStatus, CardColor, GameEventType, GameEvent } from './types';\n\nexport interface Env {\n  DB: D1Database;\n}\n\nexport default {\n  async fetch(request: Request, env: Env): Promise<Response> {\n    const url = new URL(request.url);\n    const path = url.pathname;\n    const method = request.method;\n\n    try {\n      if (path === '/' && method === 'GET') {\n        return new Response(\n          JSON.stringify({\n            service: 'ONO Game API',\n            status: 'online',\n            version: '1.0.0',\n            endpoints: {\n              room: {\n                create: 'POST /room/create',\n                join: 'POST /room/join',\n                leave: 'POST /room/leave',\n                delete: 'DELETE /room/{code}',\n                resignHost: 'POST /room/resign-host',\n              },\n              game: {\n                start: 'POST /game/start',\n                play: 'POST /game/play',\n                draw: 'POST /game/draw',\n                uno: 'POST /game/uno',\n                pass: 'POST /game/pass',\n              },\n              sync: {\n                sync: 'POST /sync',\n                poll: 'GET /poll/{code}',\n                heartbeat: 'POST /heartbeat',\n              },\n            },\n          }),\n          {\n            status: 200,\n            headers: { 'Content-Type': 'application/json' },\n          }\n        );\n      } else if (path === '/room/create' && method === 'POST') {\n        return handleCreateRoom(request, env);\n      } else if (path === '/room/join' && method === 'POST') {\n        return handleJoinRoom(request, env);\n      } else if (path === '/room/leave' && method === 'POST') {\n        return handleLeaveRoom(request, env);\n      } else if (path.startsWith('/room/') && method === 'DELETE') {\n        const code = path.split('/')[2];\n        return handleDeleteRoom(code, env);\n      } else if (path === '/room/resign-host' && method === 'POST') {\n        return handleResignHost(request, env);\n      } else if (path === '/game/start' && method === 'POST') {\n        return handleStartGame(request, env);\n      } else if (path === '/game/play' && method === 'POST') {\n        return handlePlayCard(request, env);\n      } else if (path === '/game/draw' && method === 'POST') {\n        return handleDrawCard(request, env);\n      } else if (path === '/game/uno' && method === 'POST') {\n        return handleCallUno(request, env);\n      } else if (path === '/game/pass' && method === 'POST') {\n        return handlePassTurn(request, env);\n      } else if (path === '/sync' && method === 'POST') {\n        return handleSync(request, env);\n      } else if (path.startsWith('/poll/') && method === 'GET') {\n        const code = path.split('/')[2];\n        return handlePoll(code, url.searchParams, env);\n      } else if (path === '/heartbeat' && method === 'POST') {\n        return handleHeartbeat(request, env);\n      } else if (path === '/rtc/signal' && method === 'POST') {\n        return handleSendRTCSignal(request, env);\n      } else if (path.startsWith('/rtc/signals/') && method === 'GET') {\n        const playerId = path.split('/')[3];\n        return handleGetRTCSignals(playerId, env);\n      } else {\n        return new Response('Not Found', { status: 404 });\n      }\n    } catch (error) {\n      console.error('Error:', error);\n      return new Response(JSON.stringify({ error: (error as Error).message }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n  },\n\n  async scheduled(_event: ScheduledEvent, env: Env): Promise<void> {\n    await cleanupInactiveRooms(env);\n  },\n};\n\nasync function handleCreateRoom(request: Request, env: Env): Promise<Response> {\n  try {\n    const body = await request.json() as { playerName: string; playerId: string; roomCode?: string };\n    const { playerName, playerId, roomCode: requestedRoomCode } = body;\n\n    if (!playerName || !playerId) {\n      return new Response(JSON.stringify({ error: 'Missing playerName or playerId' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    if (!requestedRoomCode || requestedRoomCode.trim().length === 0) {\n      return new Response(JSON.stringify({ error: 'Room code is required' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const roomCode = requestedRoomCode.trim().toUpperCase();\n\n    if (!/^[A-Z0-9]{3,10}$/.test(roomCode)) {\n      return new Response(JSON.stringify({ error: 'Room code must be 3-10 alphanumeric characters' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const existingRow = await env.DB.prepare('SELECT code FROM rooms WHERE code = ?')\n      .bind(roomCode)\n      .first<{ code: string }>();\n\n    if (existingRow) {\n      return new Response(JSON.stringify({ error: 'Room code already exists. Please choose a different code.' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const now = new Date().toISOString();\n    const gameState: GameState = {\n      drawPile: [],\n      discardPile: [],\n      activeColor: CardColor.red,\n      currentTurnPlayerId: null,\n      direction: 1,\n      pendingDrawCount: 0,\n      lastPlayedCardJson: null,\n      pendingWildColorChoice: null,\n      unoCalled: {},\n      stateVersion: 0,\n      lastActivity: now,\n    };\n\n    await env.DB.prepare(\n      `INSERT INTO rooms (code, host_id, status, game_state_json, current_turn_player_id, direction, active_color, pending_draw_count, state_version, last_activity)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n    )\n      .bind(\n        roomCode,\n        playerId,\n        RoomStatus.lobby,\n        JSON.stringify(gameState),\n        null,\n        1,\n        CardColor.red,\n        0,\n        0,\n        now,\n      )\n      .run();\n\n    await env.DB.prepare(\n      `INSERT INTO players (id, room_code, name, is_host, seat_number, hand_json, card_count, last_seen)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\n    )\n      .bind(\n        playerId,\n        roomCode,\n        playerName,\n        true,\n        1,\n        JSON.stringify([]),\n        0,\n        now,\n      )\n      .run();\n\n    const room = await getRoomWithPlayers(roomCode, env);\n    if (!room) {\n      return new Response(JSON.stringify({\n        type: 'ROOM_DELETED',\n        reason: 'NOT_FOUND',\n        events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n      }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    return new Response(JSON.stringify(room), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (err) {\n    return new Response(JSON.stringify({ error: 'Failed to create room' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\nasync function handleJoinRoom(request: Request, env: Env): Promise<Response> {\n  try {\n    const body = await request.json() as { roomCode: string; playerName: string; playerId: string };\n    const { roomCode, playerName, playerId } = body;\n\n    if (!roomCode || !playerName || !playerId) {\n      return new Response(JSON.stringify({ error: 'Missing required fields' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const code = roomCode.toUpperCase();\n    const now = new Date().toISOString();\n\n    const roomRow = await env.DB.prepare('SELECT code, state_version FROM rooms WHERE code = ?')\n      .bind(code)\n      .first<{ code: string; state_version: number }>();\n\n    if (!roomRow) {\n      return new Response(JSON.stringify({ error: 'ROOM_NOT_FOUND' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const existingPlayer = await env.DB.prepare('SELECT id FROM players WHERE id = ? AND room_code = ?')\n      .bind(playerId, code)\n      .first<{ id: string }>();\n\n    if (!existingPlayer) {\n      try {\n        await env.DB.prepare(\n          `INSERT INTO players (id, room_code, name, is_host, is_spectator, seat_number, hand_json, card_count, last_seen)\n           VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`\n        )\n          .bind(\n            playerId,\n            code,\n            playerName,\n            false,\n            0,\n            null,\n            JSON.stringify([]),\n            0,\n            now,\n          )\n          .run();\n      } catch (insertError: any) {\n        const raceCheck = await env.DB.prepare('SELECT id FROM players WHERE id = ? AND room_code = ?')\n          .bind(playerId, code)\n          .first<{ id: string }>();\n\n        if (!raceCheck) {\n          throw new Error(`Failed to insert player: ${insertError.message}`);\n        }\n      }\n    } else {\n      await env.DB.prepare('UPDATE players SET last_seen = ?, name = ? WHERE id = ? AND room_code = ?')\n        .bind(now, playerName, playerId, code)\n        .run();\n    }\n\n    // Always increment state version to ensure host gets the update\n    await env.DB.prepare('UPDATE rooms SET state_version = state_version + 1, last_activity = ? WHERE code = ?')\n      .bind(now, code)\n      .run();\n\n    const room = await getRoomWithPlayers(code, env);\n    if (!room) {\n      return new Response(JSON.stringify({ error: 'ROOM_NOT_FOUND' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    return new Response(JSON.stringify(room), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: 'INTERNAL_ERROR' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\nasync function handleLeaveRoom(request: Request, env: Env): Promise<Response> {\n  try {\n    const body = await request.json() as { roomCode: string; playerId: string };\n    const { roomCode, playerId } = body;\n\n    const code = roomCode.toUpperCase();\n\n    const player = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n      .bind(playerId, code)\n      .first<{ is_host: boolean; name: string }>();\n\n    if (!player) {\n      return new Response(JSON.stringify({ error: 'Player not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    if (player.is_host) {\n\n      await env.DB.prepare('DELETE FROM players WHERE room_code = ?')\n        .bind(code)\n        .run();\n      await env.DB.prepare('DELETE FROM rooms WHERE code = ?')\n        .bind(code)\n        .run();\n\n      // Explicit ROOM_DELETED response; never read room after deletion.\n      return new Response(JSON.stringify({\n        type: 'ROOM_DELETED',\n        reason: 'HOST_LEFT',\n        events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'HOST_LEFT' })],\n      }), {\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n\n    await env.DB.prepare('DELETE FROM players WHERE id = ? AND room_code = ?')\n      .bind(playerId, code)\n      .run();\n\n    const remainingPlayers = await env.DB.prepare('SELECT COUNT(*) as count FROM players WHERE room_code = ?')\n      .bind(code)\n      .first<{ count: number }>();\n\n    if (remainingPlayers && remainingPlayers.count === 0) {\n      await env.DB.prepare('DELETE FROM rooms WHERE code = ?')\n        .bind(code)\n        .run();\n\n      return new Response(JSON.stringify({\n        type: 'ROOM_DELETED',\n        reason: 'NO_PLAYERS',\n        events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NO_PLAYERS' })],\n      }), {\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    await incrementRoomStateVersion(code, env);\n    const updatedRoom = await getRoomWithPlayers(code, env);\n    if (!updatedRoom) {\n      return new Response(JSON.stringify({\n        type: 'ROOM_DELETED',\n        reason: 'NOT_FOUND',\n        events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n      }), {\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n    updatedRoom.events = [createEvent(GameEventType.PLAYER_LEFT, playerId, { playerName: player.name })];\n    return new Response(JSON.stringify(updatedRoom), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n\n    return new Response(JSON.stringify({ error: 'INTERNAL_ERROR' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\nasync function handleDeleteRoom(code: string, env: Env): Promise<Response> {\n  await env.DB.prepare('DELETE FROM players WHERE room_code = ?')\n    .bind(code.toUpperCase())\n    .run();\n  await env.DB.prepare('DELETE FROM rooms WHERE code = ?')\n    .bind(code.toUpperCase())\n    .run();\n\n  return new Response(JSON.stringify({ success: true }), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleResignHost(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  const room = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{ host_id: string }>();\n\n  if (!room || room.host_id !== playerId) {\n    return new Response(JSON.stringify({ error: 'Not the host' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const players = await env.DB.prepare('SELECT * FROM players WHERE room_code = ? AND id != ?')\n    .bind(roomCode.toUpperCase(), playerId)\n    .all<{ id: string; name: string }>();\n\n  if (players.results.length === 0) {\n    return new Response(JSON.stringify({ error: 'No other players' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const randomPlayer = players.results[Math.floor(Math.random() * players.results.length)];\n\n  await env.DB.prepare('UPDATE rooms SET host_id = ? WHERE code = ?')\n    .bind(randomPlayer.id, roomCode.toUpperCase())\n    .run();\n\n  await env.DB.prepare('UPDATE players SET is_host = ? WHERE id = ?')\n    .bind(false, playerId)\n    .run();\n\n  await env.DB.prepare('UPDATE players SET is_host = ? WHERE id = ?')\n    .bind(true, randomPlayer.id)\n    .run();\n\n  await incrementRoomStateVersion(roomCode.toUpperCase(), env);\n  const updatedRoom = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!updatedRoom) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n  updatedRoom.events = [createEvent(GameEventType.HOST_CHANGED, randomPlayer.id, {\n    oldHostId: playerId,\n    newHostId: randomPlayer.id,\n    newHostName: randomPlayer.name,\n  })];\n  return new Response(JSON.stringify(updatedRoom), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleStartGame(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{\n      host_id: string;\n      game_state_json: string;\n      state_version: number;\n    }>();\n\n  if (!roomData || roomData.host_id !== playerId) {\n    return new Response(JSON.stringify({ error: 'Not the host' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const playersData = await env.DB.prepare('SELECT * FROM players WHERE room_code = ? AND (is_spectator = 0 OR is_spectator IS NULL) ORDER BY COALESCE(seat_number, 999), is_host DESC, name ASC')\n    .bind(roomCode.toUpperCase())\n    .all<{\n      id: string;\n      is_spectator?: number;\n      seat_number?: number | null;\n    }>();\n\n  const activePlayers = playersData.results.filter(p => !p.is_spectator || p.is_spectator === 0);\n\n  if (activePlayers.length < 2) {\n    return new Response(JSON.stringify({ error: 'Need at least 2 players' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const deck = shuffleDeck(createStandardDeck());\n  const hands = dealCards(deck, activePlayers.length);\n\n  for (let i = 0; i < activePlayers.length; i++) {\n    const player = activePlayers[i];\n    await env.DB.prepare('UPDATE players SET hand_json = ?, card_count = ? WHERE id = ?')\n      .bind(\n        JSON.stringify(hands[i]),\n        hands[i].length,\n        player.id,\n      )\n      .run();\n  }\n\n  const hostPlayer = activePlayers[0];\n  const playerIdsOrdered = await getPlayerIds(roomCode.toUpperCase(), env);\n\n  const newStateVersion = roomData.state_version + 1;\n  const initialGameState: GameState = {\n    drawPile: deck,\n    discardPile: [],\n    activeColor: CardColor.red,\n    currentTurnPlayerId: hostPlayer.id,\n    direction: 1,\n    pendingDrawCount: 0,\n    lastPlayedCardJson: null,\n    pendingWildColorChoice: null,\n    unoCalled: {},\n    stateVersion: newStateVersion,\n    lastActivity: new Date().toISOString(),\n    winnerPlayerId: null,\n    winnerTimestamp: null,\n    lastPlayedCardAnimationId: null,\n  };\n\n  await env.DB.prepare(\n    `UPDATE rooms SET status = ?, game_state_json = ?, current_turn_player_id = ?, direction = ?, active_color = ?, pending_draw_count = ?, state_version = ?, last_activity = ?\n     WHERE code = ?`\n  )\n    .bind(\n      RoomStatus.playing,\n      JSON.stringify(initialGameState),\n      initialGameState.currentTurnPlayerId,\n      initialGameState.direction,\n      initialGameState.activeColor,\n      initialGameState.pendingDrawCount,\n      newStateVersion,\n      initialGameState.lastActivity,\n      roomCode.toUpperCase(),\n    )\n    .run();\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handlePlayCard(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as {\n    roomCode: string;\n    playerId: string;\n    card: any;\n    chosenColor?: string;\n  };\n  const { roomCode, playerId, card, chosenColor } = body;\n\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{\n      game_state_json: string;\n      current_turn_player_id: string;\n      state_version: number;\n    }>();\n\n  if (!roomData) {\n    return new Response(JSON.stringify({ error: 'Room not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  if (roomData.current_turn_player_id !== playerId) {\n    return new Response(JSON.stringify({ error: 'Not your turn' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const gameState = JSON.parse(roomData.game_state_json) as GameState;\n  const player = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n    .bind(playerId, roomCode.toUpperCase())\n    .first<{ hand_json: string }>();\n\n  if (!player) {\n    return new Response(JSON.stringify({ error: 'Player not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const hand = JSON.parse(player.hand_json) as any[];\n  const cardIndex = hand.findIndex(\n    (c) => c.color === card.color && c.type === card.type && c.number === card.number\n  );\n\n  if (cardIndex === -1) {\n    return new Response(JSON.stringify({ error: 'Card not in hand' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const playerData = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n    .bind(playerId, roomCode.toUpperCase())\n    .first<{ is_spectator?: boolean }>();\n\n  if (playerData && playerData.is_spectator) {\n    return new Response(JSON.stringify({ error: 'Spectators cannot play cards' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const topCard = gameState.discardPile.length > 0\n    ? gameState.discardPile[gameState.discardPile.length - 1]\n    : null;\n\n  if (topCard != null && !canPlayCard(card, topCard, gameState.activeColor, gameState.pendingDrawCount, hand)) {\n    return new Response(JSON.stringify({ error: 'Invalid card' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  if (card.isWild && !chosenColor) {\n    return new Response(JSON.stringify({ error: 'Wild card requires color choice' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  hand.splice(cardIndex, 1);\n\n  let updatedGameState = processCardPlay(\n    gameState,\n    card,\n    chosenColor as CardColor | undefined,\n    playerId,\n    await getPlayerIds(roomCode.toUpperCase(), env),\n  );\n\n  if (updatedGameState.discardPile.length > 6) {\n    const pile = updatedGameState.discardPile;\n    const lastCard = pile[pile.length - 1];\n    const toRecycle = pile.slice(0, -1);\n    const newDrawPile = shuffleDeck([...updatedGameState.drawPile, ...toRecycle]);\n    updatedGameState = {\n      ...updatedGameState,\n      drawPile: newDrawPile,\n      discardPile: [lastCard],\n    };\n  }\n\n  let winnerDetected = false;\n  let winnerPlayerId: string | null = null;\n\n  if (hand.length === 0) {\n    winnerDetected = true;\n    winnerPlayerId = playerId;\n    updatedGameState.winnerPlayerId = playerId;\n    updatedGameState.winnerTimestamp = new Date().toISOString();\n    updatedGameState.currentTurnPlayerId = null;\n  }\n\n  await env.DB.prepare('UPDATE players SET hand_json = ?, card_count = ? WHERE id = ?')\n    .bind(JSON.stringify(hand), hand.length, playerId)\n    .run();\n\n  await env.DB.prepare(\n    `UPDATE rooms SET status = ?, game_state_json = ?, current_turn_player_id = ?, direction = ?, active_color = ?, pending_draw_count = ?, state_version = ?, last_activity = ?\n     WHERE code = ?`\n  )\n    .bind(\n      winnerDetected ? RoomStatus.finished : RoomStatus.playing,\n      JSON.stringify(updatedGameState),\n      updatedGameState.currentTurnPlayerId,\n      updatedGameState.direction,\n      updatedGameState.activeColor,\n      updatedGameState.pendingDrawCount,\n      roomData.state_version + 1,\n      updatedGameState.lastActivity,\n      roomCode.toUpperCase(),\n    )\n    .run();\n\n  if (!winnerDetected) {\n    await checkUnoCall(updatedGameState, playerId, hand.length, env, roomCode.toUpperCase());\n  } else {\n    setTimeout(async () => {\n      await env.DB.prepare('DELETE FROM players WHERE room_code = ?')\n        .bind(roomCode.toUpperCase())\n        .run();\n      await env.DB.prepare('DELETE FROM rooms WHERE code = ?')\n        .bind(roomCode.toUpperCase())\n        .run();\n    }, 10000);\n  }\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleDrawCard(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{\n      game_state_json: string;\n      current_turn_player_id: string;\n      state_version: number;\n    }>();\n\n  if (!roomData || roomData.current_turn_player_id !== playerId) {\n    return new Response(JSON.stringify({ error: 'Not your turn' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const gameState = JSON.parse(roomData.game_state_json) as GameState;\n  const player = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n    .bind(playerId, roomCode.toUpperCase())\n    .first<{ hand_json: string }>();\n\n  if (!player) {\n    return new Response(JSON.stringify({ error: 'Player not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  let drawCount = 1;\n  if (gameState.pendingDrawCount > 0) {\n    drawCount = gameState.pendingDrawCount;\n  }\n\n  const hand = JSON.parse(player.hand_json) as any[];\n  let drawPile = gameState.drawPile;\n\n  if (drawPile.length < drawCount) {\n    const discardPile = gameState.discardPile.slice(0, -1);\n    drawPile = shuffleDeck(discardPile);\n    gameState.discardPile = [gameState.discardPile[gameState.discardPile.length - 1]];\n  }\n\n  const drawnCards = drawPile.splice(0, drawCount);\n  hand.push(...drawnCards);\n\n  const updatedGameState: GameState = {\n    ...gameState,\n    drawPile,\n    pendingDrawCount: 0,\n    currentTurnPlayerId: getNextPlayer(\n      playerId,\n      await getPlayerIds(roomCode.toUpperCase(), env),\n      gameState.direction,\n    ),\n    stateVersion: roomData.state_version + 1,\n    lastActivity: new Date().toISOString(),\n  };\n\n  await env.DB.prepare('UPDATE players SET hand_json = ?, card_count = ? WHERE id = ?')\n    .bind(JSON.stringify(hand), hand.length, playerId)\n    .run();\n\n  await env.DB.prepare(\n    `UPDATE rooms SET game_state_json = ?, current_turn_player_id = ?, pending_draw_count = ?, state_version = ?, last_activity = ?\n     WHERE code = ?`\n  )\n    .bind(\n      JSON.stringify(updatedGameState),\n      updatedGameState.currentTurnPlayerId,\n      0,\n      updatedGameState.stateVersion,\n      updatedGameState.lastActivity,\n      roomCode.toUpperCase(),\n    )\n    .run();\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleCallUno(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{ game_state_json: string; state_version: number }>();\n\n  if (!roomData) {\n    return new Response(JSON.stringify({ error: 'Room not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const gameState = JSON.parse(roomData.game_state_json) as GameState;\n  const player = await env.DB.prepare('SELECT * FROM players WHERE id = ? AND room_code = ?')\n    .bind(playerId, roomCode.toUpperCase())\n    .first<{ hand_json: string }>();\n\n  if (!player) {\n    return new Response(JSON.stringify({ error: 'Player not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const hand = JSON.parse(player.hand_json) as any[];\n\n  if (hand.length !== 1) {\n    return new Response(JSON.stringify({ error: 'Must have exactly 1 card' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  if (gameState.unoCalled[playerId]) {\n    return new Response(JSON.stringify({ error: 'UNO already called' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  gameState.unoCalled[playerId] = true;\n  gameState.stateVersion = roomData.state_version + 1;\n  gameState.lastActivity = new Date().toISOString();\n\n  await env.DB.prepare('UPDATE rooms SET game_state_json = ?, state_version = ?, last_activity = ? WHERE code = ?')\n    .bind(JSON.stringify(gameState), gameState.stateVersion, gameState.lastActivity, roomCode.toUpperCase())\n    .run();\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handlePassTurn(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode.toUpperCase())\n    .first<{\n      game_state_json: string;\n      current_turn_player_id: string;\n      state_version: number;\n    }>();\n\n  if (!roomData || roomData.current_turn_player_id !== playerId) {\n    return new Response(JSON.stringify({ error: 'Not your turn' }), {\n      status: 403,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const gameState = JSON.parse(roomData.game_state_json) as GameState;\n\n  const updatedGameState: GameState = {\n    ...gameState,\n    currentTurnPlayerId: getNextPlayer(\n      playerId,\n      await getPlayerIds(roomCode.toUpperCase(), env),\n      gameState.direction,\n    ),\n    stateVersion: roomData.state_version + 1,\n    lastActivity: new Date().toISOString(),\n  };\n\n  await env.DB.prepare(\n    `UPDATE rooms SET game_state_json = ?, current_turn_player_id = ?, state_version = ?, last_activity = ?\n     WHERE code = ?`\n  )\n    .bind(\n      JSON.stringify(updatedGameState),\n      updatedGameState.currentTurnPlayerId,\n      updatedGameState.stateVersion,\n      updatedGameState.lastActivity,\n      roomCode.toUpperCase(),\n    )\n    .run();\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleSync(request: Request, env: Env): Promise<Response> {\n  const body = await request.json() as { roomCode: string; playerId: string; stateVersion: number };\n  const { roomCode, playerId, stateVersion } = body;\n\n  const room = await getRoomWithPlayers(roomCode.toUpperCase(), env);\n\n  if (!room) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  if (room.gameState && room.gameState.stateVersion <= stateVersion) {\n    return new Response(null, { status: 204 });\n  }\n\n  return new Response(JSON.stringify(room), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handlePoll(code: string, searchParams: URLSearchParams, env: Env): Promise<Response> {\n  const playerId = searchParams.get('playerId');\n  const lastKnownVersion = parseInt(searchParams.get('lastKnownVersion') || '0', 10);\n  const isSpectator = searchParams.get('isSpectator') === 'true';\n\n  try {\n    // First check if room exists and get its state_version\n    const roomStateVersion = await env.DB.prepare('SELECT state_version FROM rooms WHERE code = ?')\n      .bind(code.toUpperCase())\n      .first<{ state_version: number }>();\n\n    if (!roomStateVersion) {\n      return new Response(JSON.stringify({\n        type: 'ROOM_DELETED',\n        reason: 'NOT_FOUND',\n        events: [createEvent(GameEventType.ROOM_DELETED, playerId || undefined, { reason: 'NOT_FOUND' })],\n      }), {\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // If room has changed, return immediately\n    if (roomStateVersion.state_version > lastKnownVersion) {\n      const room = await getRoomWithPlayers(code.toUpperCase(), env);\n      if (room) {\n        return new Response(JSON.stringify(room), {\n          headers: { 'Content-Type': 'application/json' },\n        });\n      }\n    }\n\n    // Long poll: wait for changes\n    const maxWait = isSpectator ? 5 : 15;\n    const checkInterval = isSpectator ? 2000 : 1000;\n\n    for (let i = 0; i < maxWait; i++) {\n      await new Promise(resolve => setTimeout(resolve, checkInterval));\n      try {\n        const roomData = await env.DB.prepare('SELECT state_version FROM rooms WHERE code = ?')\n          .bind(code.toUpperCase())\n          .first<{ state_version: number }>();\n\n        if (!roomData) {\n          return new Response(JSON.stringify({\n            type: 'ROOM_DELETED',\n            reason: 'NOT_FOUND',\n            events: [createEvent(GameEventType.ROOM_DELETED, playerId || undefined, { reason: 'NOT_FOUND' })],\n          }), {\n            headers: { 'Content-Type': 'application/json' },\n          });\n        }\n\n        if (roomData.state_version > lastKnownVersion) {\n          const updatedRoom = await getRoomWithPlayers(code.toUpperCase(), env);\n          if (updatedRoom) {\n            return new Response(JSON.stringify(updatedRoom), {\n              headers: { 'Content-Type': 'application/json' },\n            });\n          }\n        }\n      } catch (e) {\n        return new Response(JSON.stringify({\n          type: 'ROOM_DELETED',\n          reason: 'NOT_FOUND',\n          events: [createEvent(GameEventType.ROOM_DELETED, playerId || undefined, { reason: 'NOT_FOUND' })],\n        }), {\n          headers: { 'Content-Type': 'application/json' },\n        });\n      }\n    }\n\n    return new Response(JSON.stringify({ changed: false }), {\n      status: 304,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (e) {\n    return new Response(JSON.stringify({\n      type: 'ROOM_DELETED',\n      reason: 'NOT_FOUND',\n      events: [createEvent(GameEventType.ROOM_DELETED, playerId || undefined, { reason: 'NOT_FOUND' })],\n    }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\nasync function handleHeartbeat(request: Request, env: Env): Promise<Response> {\n\n  const body = await request.json() as { roomCode: string; playerId: string };\n  const { roomCode, playerId } = body;\n\n  await env.DB.prepare('UPDATE players SET last_seen = ? WHERE id = ? AND room_code = ?')\n    .bind(new Date().toISOString(), playerId, roomCode.toUpperCase())\n    .run();\n\n  return new Response(JSON.stringify({ success: true }), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function cleanupInactiveRooms(env: Env): Promise<void> {\n  const cutoff = new Date(Date.now() - 5 * 60 * 1000).toISOString();\n  const staleRooms = await env.DB.prepare('SELECT code FROM rooms WHERE last_activity < ?')\n    .bind(cutoff)\n    .all<{ code: string }>();\n\n  if (!staleRooms.results.length) return;\n\n  const codes = staleRooms.results.map((r) => r.code);\n  const placeholders = codes.map(() => '?').join(', ');\n\n  await env.DB.prepare(\n    `DELETE FROM players WHERE room_code IN (${placeholders})`\n  )\n    .bind(...codes)\n    .run();\n\n  await env.DB.prepare(\n    `DELETE FROM rooms WHERE code IN (${placeholders})`\n  )\n    .bind(...codes)\n    .run();\n}\n\nfunction generateRoomCode(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  let result = '';\n  for (let i = 0; i < 6; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\ninterface PlayerRow {\n  id: string;\n  name: string;\n  room_code: string;\n  is_host: number;\n  is_spectator?: number;\n  seat_number?: number | null;\n  hand_json?: string | null;\n  last_seen: string;\n}\n\nasync function getRoomWithPlayers(roomCode: string, env: Env): Promise<Room | null> {\n  const roomData = await env.DB.prepare('SELECT * FROM rooms WHERE code = ?')\n    .bind(roomCode)\n    .first<{\n      code: string;\n      host_id: string;\n      status: string;\n      game_state_json: string;\n      current_turn_player_id: string | null;\n      direction: number;\n      active_color: string;\n      pending_draw_count: number;\n      state_version: number;\n      last_activity: string;\n    }>();\n\n  if (!roomData) {\n    return null;\n  }\n\n  const playerRows = await env.DB.prepare('SELECT * FROM players WHERE room_code = ? ORDER BY COALESCE(seat_number, 999), is_host DESC, name ASC')\n    .bind(roomCode)\n    .all<PlayerRow>();\n\n  const players: Player[] = playerRows.results.map((raw) => ({\n    id: raw.id,\n    name: raw.name,\n    roomCode: raw.room_code,\n    isHost: raw.is_host === 1,\n    isSpectator: (raw.is_spectator ?? 0) === 1,\n    seatNumber: raw.seat_number ?? undefined,\n    hand: raw.hand_json ? JSON.parse(raw.hand_json) : [],\n    lastSeen: raw.last_seen,\n  }));\n\n  let gameState: GameState | null = null;\n  if ((roomData.status === RoomStatus.playing || roomData.status === RoomStatus.finished) && roomData.game_state_json) {\n    try {\n      gameState = JSON.parse(roomData.game_state_json);\n    } catch {\n      gameState = null;\n    }\n  }\n\n  return {\n    code: roomData.code,\n    hostId: roomData.host_id,\n    status: roomData.status as RoomStatus,\n    gameState,\n    players,\n    lastActivity: roomData.last_activity,\n    stateVersion: roomData.state_version,\n  };\n}\n\nasync function getPlayerIds(roomCode: string, env: Env): Promise<string[]> {\n  const players = await env.DB.prepare('SELECT id, seat_number FROM players WHERE room_code = ? AND (is_spectator = 0 OR is_spectator IS NULL) ORDER BY COALESCE(seat_number, 999), is_host DESC, name ASC')\n    .bind(roomCode)\n    .all<{ id: string; seat_number?: number | null }>();\n\n  return players.results.map(p => p.id);\n}\n\nasync function incrementRoomStateVersion(roomCode: string, env: Env): Promise<void> {\n  const now = new Date().toISOString();\n  await env.DB.prepare('UPDATE rooms SET state_version = state_version + 1, last_activity = ? WHERE code = ?')\n    .bind(now, roomCode.toUpperCase())\n    .run();\n}\n\nfunction createEvent(type: GameEventType, playerId?: string, data?: any): GameEvent {\n  return {\n    type,\n    playerId,\n    data,\n    timestamp: new Date().toISOString(),\n    eventId: `${type}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  };\n}\nasync function handleGetRTCSignals(playerId: string, env: Env): Promise<Response> {\n  if (!playerId) {\n    return new Response(JSON.stringify({ error: 'Missing playerId' }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n\n  const signals = await env.DB.prepare(\n    'SELECT * FROM rtc_signals WHERE to_player_id = ? ORDER BY created_at ASC'\n  )\n    .bind(playerId)\n    .all<{\n      id: number;\n      room_code: string;\n      from_player_id: string;\n      to_player_id: string;\n      signal_type: string;\n      signal_data: string;\n      created_at: string;\n    }>();\n\n  if (signals.results.length > 0) {\n    const ids = signals.results.map(s => s.id);\n    const placeholders = ids.map(() => '?').join(',');\n    await env.DB.prepare(`DELETE FROM rtc_signals WHERE id IN (${placeholders})`)\n      .bind(...ids)\n      .run();\n  }\n\n  return new Response(JSON.stringify({ signals: signals.results }), {\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleSendRTCSignal(request: Request, env: Env): Promise<Response> {\n  try {\n    const body = await request.json() as {\n      roomCode: string;\n      fromPlayerId: string;\n      toPlayerId: string;\n      signalType: string;\n      signalData: string;\n    };\n\n    const { roomCode, fromPlayerId, toPlayerId, signalType, signalData } = body;\n\n    if (!roomCode || !fromPlayerId || !toPlayerId || !signalType || !signalData) {\n      return new Response(JSON.stringify({ error: 'Missing required fields' }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    await env.DB.prepare(\n      `INSERT INTO rtc_signals (room_code, from_player_id, to_player_id, signal_type, signal_data)\n       VALUES (?, ?, ?, ?, ?)`\n    )\n      .bind(roomCode.toUpperCase(), fromPlayerId, toPlayerId, signalType, signalData)\n      .run();\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: 'INTERNAL_ERROR' }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": ["currentIndex", "nextIndex"]
}
